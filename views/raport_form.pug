doctype html
html(lang='en')
head
  title= title
  meta(charset='utf-8')
  meta(name='viewport', content='width=device-width, initial-scale=1')
  link(rel="stylesheet", href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css", integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z", crossorigin="anonymous")
  link(rel='stylesheet', href='/stylesheets/style.css')
  link(href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700&amp;subset=latin-ext" rel="stylesheet")

  script(src="https://code.jquery.com/jquery-3.5.1.min.js")
  script(src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous")
    // Always remember to call the above files first before calling the bootstrap.min.js file
  script(src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous")

  script.
    function postPresence(this_button){
      // 'this' is a trick to pass 'raport.users' into script
      // also added 'name' to transfer raport_id
      // it looks weird but it works for me lol
      // It comes as string so parse it back to object. Then iterate
      activeUsers = JSON.parse(this_button.value)
      postUsers = []
      for(i = 0; i < activeUsers.length; i++){
        postUsers.push([activeUsers[i]['_id'], document.getElementById(activeUsers[i]['_id']).checked])
      }
      console.log(postUsers)
        $.post( "", {postUsers: JSON.stringify(postUsers), raportId: this_button.name});
    }
body
  header
    nav(class="navbar navbar-dark bg-gestampblue navbar-expand-lg")
      a(href="/api/raport" class="navbar-brand")
        img(src="https://www.gestamp.com/Gestamp11/media/GestampFiles/Logo-Gestamp-(white)02.svg" height="30" class="d-inline-block align-bottom mr-4" alt="Gestamp ಠ_ಠ")
      button(class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainmenu")
        span(class="navbar-toggler-icon")
      div(class="collapse navbar-collapse" id="mainmenu")
        ul(class="navbar-nav")
          li(class="nav-item")
            a(class="nav-link" href="/api/raport/create") Raport
          li(class="nav-item")
            a(class="nav-link" href="/api/plan") Prace Planowane
          li(class="nav-item dropdown")
            a(class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" role="button" id="device-dropdown") Menedżer urządzeń
            div(class="dropdown-menu")
              a(class="dropdown-item" href="/api/line") Linie Produkcyjne
              a(class="dropdown-item" href="/api/devicetype") Typy Urządzeń
              a(class="dropdown-item" href="/api/device") Urządzenia
          li(class="nav-item dropdown")
            a(class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" role="button" id="search-dropdown") Zarządzanie zespołem
            div(class="dropdown-menu")
              a(class="dropdown-item" href="/api/user") Pracownicy
              a(class="dropdown-item" href="/api/user/team") Skład Zmiany
          li(class="nav-item dropdown")
            a(class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" role="button" id="search-dropdown") Wyszukiwanie
            div(class="dropdown-menu")
              a(class="dropdown-item" href="search/raport") Raporty
              a(class="dropdown-item" href="/search/breakdown") Awarie

  div(class='container-fluid')
    div(class='row')
      // navbar
      aside(class='col-sm-2 my-3 umfy-vertical-navbar')

          div(class="accordion" id="accordionExample")
          
            div(class="card bg-gestampblue")
              div(class="card-header" id="headingReport")
                a(href="/api/raport/create")
                  button(class="btn btn-link btn-block text-left  text-light" type="button")
                    | Raport

            div(class="card bg-gestampblue")
              div(class="card-header" id="headingPlan")
                a(href="/api/plan")
                  button(class="btn btn-link btn-block text-left  text-light" type="button")
                    | Prace planowane


            div(class="card bg-gestampblue")
              div(class="card-header" id="headingOne")
                h2(class="mb-0")
                  button(class="btn btn-link btn-block text-left collapsed text-light" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne")
                    Collapsible Menedżer urządzeń
              div(id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample")
                div(class="card-body bg-light")
                  a(class="dropdown-item" href="/api/line") Linie produkcyjne
                  a(class="dropdown-item" href="/api/devicetype") Typy Urządzeń
                  a(class="dropdown-item" href="/api/device") Urządzenia


            div(class="card bg-gestampblue")
              div(class="card-header" id="headingTwo")
                h2(class="mb-0")
                  button(class="btn btn-link btn-block text-left collapsed text-light" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo")
                    Collapsible Zarządzanie zespołem
              div(id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample")
                div(class="card-body bg-light")
                  a(class="dropdown-item" href="/api/user") Pracownicy
                  a(class="dropdown-item" href="/api/user/team") Skład Zmiany
              
            div(class="card bg-gestampblue")
              div(class="card-header" id="headingThree")
                h2(class="mb-0")
                  button(class="btn btn-link btn-block text-left collapsed text-light" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree")
                    Collapsible Wyszukiwanie
              div(id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample")
                div(class="card-body bg-light")
                  a(class="dropdown-item" href="/api/search/raport") Raporty
                  a(class="dropdown-item" href="/api/search/breakdown") Awarie

      // main display
      div(class='col')
        div(class='row')
          div(class='col-lg-6 py-4')
            table(class='table table-bordered') Skład zmiany
              thead
                tr
                  th(scope="col") Imię
                  th(scope="col") Nazwisko
                  th(scope="col") Specjalizacja
                  th(scope="col") Obecny
              tbody
                  each user in raport.users
                    tr
                      td #{user.name}
                      td #{user.surname}
                      td #{user.spec}
                      td
                        div(class='form-check') 
                          input(class="form-check-input" type="checkbox" name=user._id value=1 id=user._id checked=false)

            div 
              button(class="btn btn-primary mb-2" type='button' name=raport._id value=raport.users  onclick="postPresence(this)") Zapisz          

            table(class="table table-bordered") Obchód
              thead 
                tr 
                  th(scope="col") Miejsce
                  th(scope="col") Opis
                  th(scope="col") stan
              tbody
                tr
                  form(method='POST' action='')
                    td Kotłownia
                    td 
                      input(class="form-control" type="text")
                    td
                      div(class='form-check') 
                        input(class="form-check-input" type="checkbox" name="kettle" value=1 checked=false)
            div(class='col') Prace Planowane

            div(class='col') Działania dodatkowe

          div(class='col-lg-6 py-4') Awarie